<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poƒças√≠ s AccuWeather API - Ji≈ô√≠k≈Øv projekt</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0d1a2b; /* Tmavƒõ modr√°, jako vesm√≠r pro Star Trek projekty */
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #1a2a40; /* Trochu svƒõtlej≈°√≠ odst√≠n modr√© */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-width: 900px; /* Roz≈°√≠≈ôen√≠ pro tabulky */
            width: 100%;
            position: relative; /* Pro mod√°ln√≠ okno */
            z-index: 1; /* Aby bylo pod modalem */
        }
        h1 {
            color: #61dafb; /* Akcentn√≠ barva, jako LEDky! */
            margin-bottom: 25px;
            font-size: 2.2em;
        }
        .search-section {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap; /* Pro responzivitu tlaƒç√≠tek */
            justify-content: center;
            gap: 10px; /* Mezery mezi prvky */
        }
        input[type="text"] {
            padding: 12px 15px;
            flex-grow: 1; /* Aby se rozt√°hl */
            min-width: 200px; /* Minim√°ln√≠ ≈°√≠≈ôka pro mobil */
            border: 1px solid #3a4a60;
            border-radius: 8px;
            background-color: #0f1825;
            color: #e0e0e0;
            font-size: 1.1em;
            transition: border-color 0.3s ease;
        }
        input[type="text"]:focus {
            border-color: #61dafb;
            outline: none;
        }
        button {
            padding: 12px 25px;
            background-color: #61dafb;
            color: #0d1a2b;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            background-color: #4dc2ea;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        button.favorite-btn {
            background-color: #28a745;
            font-size: 0.9em;
            padding: 8px 15px;
        }
        button.favorite-btn:hover {
            background-color: #218838;
        }
        button.remove-btn {
            background-color: #dc3545;
            font-size: 0.8em;
            padding: 6px 10px;
            margin-left: 8px;
        }
        button.remove-btn:hover {
            background-color: #c82333;
        }
        .favorites-section {
            margin: 20px 0;
            padding: 20px;
            background-color: #0f1825;
            border-radius: 10px;
            border: 1px solid #3a4a60;
        }
        .favorites-title {
            color: #61dafb;
            font-size: 1.3em;
            margin-bottom: 15px;
        }
        .favorite-item {
            display: inline-flex;
            align-items: center;
            margin: 5px;
            background-color: #1a2a40;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #3a4a60;
        }
        .management-section {
            margin: 20px 0;
            padding: 15px;
            background-color: #0f1825;
            border-radius: 10px;
            border: 1px solid #3a4a60;
        }
        .management-title {
            color: #ffa500;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        #weather-info {
            margin-top: 30px;
            font-size: 1.2em;
            line-height: 1.6;
            text-align: left;
            border-top: 1px solid #3a4a60;
            padding-top: 20px;
            display: none; /* Skryjeme, dokud se nez√≠skaj√≠ data */
            overflow-x: auto; /* Pro vodorovn√© posouv√°n√≠ tabulek na men≈°√≠ch obrazovk√°ch */
        }
        #weather-info p {
            margin-bottom: 10px;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
            margin-top: 20px;
        }
        .loading {
            color: #61dafb;
            margin-top: 20px;
        }
        .success {
            color: #28a745;
            font-weight: bold;
            margin-top: 10px;
        }
        footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #90a0b8;
            text-align: center;
        }
        .debug-section {
            margin-top: 20px;
            padding: 10px;
            background-color: #2d1810;
            border-radius: 8px;
            border: 1px solid #8b4513;
            font-family: monospace;
            font-size: 0.9em;
            text-align: left;
        }
        .debug-title {
            color: #ffa500;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* --- Styly pro tabulku p≈ôedpovƒõdi --- */
        .forecast-table, .current-conditions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #0f1825; /* Tmav≈°√≠ pozad√≠ pro tabulku */
            border-radius: 8px; /* Zaoblen√© rohy tabulky */
            overflow: hidden; /* Pro zaoblen√≠ roh≈Ø s border-collapse */
        }
        .forecast-table th, .current-conditions-table th,
        .forecast-table td, .current-conditions-table td {
            border: 1px solid #3a4a60; /* Tenk√Ω ≈°ed√Ω r√°meƒçek */
            padding: 12px;
            text-align: center;
        }
        .forecast-table th, .current-conditions-table th {
            background-color: #2a3a50; /* Hlaviƒçka tabulky s akcentem */
            color: #61dafb;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }
        .forecast-table tbody tr:nth-child(even),
        .current-conditions-table tbody tr:nth-child(even) {
            background-color: #1a2a40; /* St≈ô√≠dav√© ≈ô√°dky pro lep≈°√≠ ƒçitelnost */
        }
        .forecast-table td, .current-conditions-table td {
            font-size: 0.95em;
        }
        /* Pro ikony, kdy≈æ jsou to emoji nebo znaky */
        .weather-icon {
            font-size: 1.8em; /* Vƒõt≈°√≠ velikost pro emoji ikonu */
            line-height: 1; /* Lep≈°√≠ zarovn√°n√≠ */
            display: block; /* Aby byla na vlastn√≠m ≈ô√°dku v bu≈àce */
            margin: 0 auto 5px auto; /* Centrov√°n√≠ a mezera pod */
        }
        /* Specific alignment for current conditions table values */
        .current-conditions-table td:first-child {
            text-align: left; /* Zarovn√°n√≠ n√°zv≈Ø informac√≠ vlevo */
            font-weight: bold;
            color: #a0c2e8; /* M√≠rnƒõ svƒõtlej≈°√≠ barva pro n√°zev informace */
        }
        .current-conditions-table td:last-child {
            text-align: right; /* Zarovn√°n√≠ hodnot vpravo */
        }

        /* --- Styly pro vlastn√≠ mod√°ln√≠ okno (dialog) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Tmav≈°√≠ pr≈Øhledn√© pozad√≠ */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000; /* Nad v≈°emi ostatn√≠mi prvky */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #1a2a40; /* Stejn√© jako container */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 450px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-content p {
            font-size: 1.2em;
            margin-bottom: 25px;
            color: #e0e0e0;
        }
        .modal-buttons button {
            margin: 0 10px;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .modal-buttons .confirm-btn {
            background-color: #28a745;
            color: #fff;
        }
        .modal-buttons .confirm-btn:hover {
            background-color: #218838;
        }
        .modal-buttons .cancel-btn {
            background-color: #dc3545;
            color: #fff;
        }
        .modal-buttons .cancel-btn:hover {
            background-color: #c82333;
        }

        /* Responzivn√≠ √∫pravy */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.8em;
            }
            input[type="text"], button {
                width: 100%; /* Pln√° ≈°√≠≈ôka na mobilu */
                margin: 5px 0; /* Vertik√°ln√≠ mezera */
            }
            .search-section {
                flex-direction: column; /* Sloupcov√© uspo≈ô√°d√°n√≠ */
                gap: 5px;
            }
            .favorite-item {
                flex-direction: column;
                align-items: stretch;
                padding: 10px;
            }
            .favorite-item button {
                width: auto;
                margin: 5px 0;
            }
            .favorite-item .remove-btn {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåå Poƒças√≠ s AccuWeather API üåü</h1>
        <p>Zadej mƒõsto, Ji≈ô√≠ku, a≈• v√≠me, jestli ti budou blikat LEDky! üí°</p>
        
        <div class="search-section">
            <input type="text" id="city-input" placeholder="Nap≈ô. Praha, T√°bor, Pelh≈ôimov...">
            <button onclick="getWeather()">Z√≠skat poƒças√≠</button>
            <button onclick="addToFavorites()" class="favorite-btn">‚ûï P≈ôidat k obl√≠ben√Ωm</button>
        </div>

        <div class="favorites-section">
            <div class="favorites-title">‚≠ê Obl√≠ben√° m√≠sta</div>
            <div id="favorites-list">
                </div>
        </div>

        <div class="management-section">
            <div class="management-title">üîß Spr√°va obl√≠ben√Ωch m√≠st</div>
            <button onclick="clearAllFavorites()" class="remove-btn">üóëÔ∏è Smazat v≈°echna m√≠sta</button>
            <button onclick="exportFavorites()">üì§ Exportovat m√≠sta</button>
            <button onclick="showDebugInfo()">üîç Debug localStorage</button>
        </div>

        <div id="loading-message" class="loading" style="display: none;">Naƒç√≠t√°m data... üõ∞Ô∏è</div>
        <div id="error-message" class="error" style="display: none;"></div>
        <div id="success-message" class="success" style="display: none;"></div>
        <div id="weather-info"></div>
        <div id="debug-info" class="debug-section" style="display: none;">
            <div class="debug-title">üîç Debug informace localStorage:</div>
            <div id="debug-content"></div>
        </div>
    </div>
    <footer>
        Projekt inspirovan√Ω technick√Ωmi v√Ωzvami, Star Trekem a blikaj√≠c√≠mi svƒõt√Ωlky. ‚ú®<br>
        Nyn√≠ s pokroƒçilou spr√°vou obl√≠ben√Ωch m√≠st! üöÄ
    </footer>

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button id="modal-confirm-btn" class="confirm-btn">Ano</button>
                <button id="modal-cancel-btn" class="cancel-btn">Zru≈°it</button>
            </div>
        </div>
    </div>

    <script>
        // *** SEM VLO≈Ω SV≈ÆJ ACCUWEATHER API KL√çƒå! ***
        // Ji≈ô√≠ku, tv≈Øj kl√≠ƒç je tam spr√°vnƒõ, jen jsem to nechal jako p≈ôipom√≠nku pro ostatn√≠!
        const ACCUWEATHER_API_KEY = "CFM41jgyDxgyOgRSUJxcDRF5TWIWv7kg";

        // URL pro AccuWeather API
        const LOCATION_SEARCH_URL = "https://dataservice.accuweather.com/locations/v1/cities/search";
        const CURRENT_CONDITIONS_URL = "https://dataservice.accuweather.com/currentconditions/v1/";
        const FORECAST_5_DAY_URL = "https://dataservice.accuweather.com/forecasts/v1/daily/5day/";
        
        // Glob√°ln√≠ promƒõnn√° pro aktu√°ln√≠ mƒõsto
        let currentCity = "";

        // === MAPOV√ÅN√ç ƒå√çSEL IKON NA EMOJI ===
        // Toto je ta "vlastn√≠ ikonka p≈ô√≠mo v k√≥du", Ji≈ô√≠ku!
        const weatherIconMap = {
            1: '‚òÄÔ∏è', // Sluneƒçno
            2: 'üå§Ô∏è', // Vƒõt≈°inou sluneƒçno
            3: '‚õÖ', // St≈ô√≠davƒõ oblaƒçno
            4: '‚òÅÔ∏è', // Skoro zata≈æeno (tv≈Øj 4)
            5: '‚òÅÔ∏è', // ƒå√°steƒçnƒõ zata≈æeno
            6: '‚òÅÔ∏è', // Skoro zata≈æeno (tv≈Øj 6)
            7: '‚òÅÔ∏è', // Zata≈æeno
            8: '‚òÅÔ∏è', // ≈†ed√©
            11: 'üå´Ô∏è', // Mlha
            12: 'üåßÔ∏è', // P≈ôeh√°≈àky
            13: 'üå¶Ô∏è', // P≈ôeh√°≈àky / ƒç√°steƒçnƒõ sluneƒçno
            14: '‚õàÔ∏è', // P≈ôeh√°≈àky s bou≈ôkami
            15: '‚õàÔ∏è', // Bou≈ôky (tv≈Øj 15)
            16: 'üå©Ô∏è', // Skoro zata≈æeno s bou≈ôkami (tv≈Øj 16 - vybral jsem blesk pro odli≈°en√≠ od 15)
            17: 'üå©Ô∏è', // P≈ôeh√°≈àky s blesky
            18: 'üåßÔ∏è', // D√©≈°≈• (tv≈Øj 18)
            19: 'üå®Ô∏è', // Sn√≠h
            20: 'üå®Ô∏è', // Skoro zata≈æeno se snƒõhem
            21: '‚ùÑÔ∏è', // ƒå√°steƒçnƒõ sluneƒçno se snƒõhem
            22: '‚ùÑÔ∏è', // Snƒõ≈æen√≠
            23: 'üå®Ô∏è', // Mrznouc√≠ d√©≈°≈• / sn√≠h
            24: 'üßä', // Led
            25: 'üå®Ô∏è', // Sm√≠≈°en√© sr√°≈æky
            26: 'üå®Ô∏è', // Mrznouc√≠ d√©≈°≈•
            29: 'üå®Ô∏è', // Sn√≠h
            30: 'üî•', // Horko
            31: 'ü•∂', // Zima
            32: 'üí®', // Vƒõtrno
            33: '‚ú®', // Jasno (noc)
            34: '‚òÅÔ∏è', // Vƒõt≈°inou jasno (noc)
            35: '‚òÅÔ∏è', // ƒå√°steƒçnƒõ zata≈æeno (noc)
            36: '‚òÅÔ∏è', // Skoro zata≈æeno (noc)
            37: '‚òÅÔ∏è', // St≈ô√≠davƒõ zata≈æeno (noc)
            38: '‚òÅÔ∏è', // Skoro zata≈æeno (noc)
            39: 'üåßÔ∏è', // P≈ôeh√°≈àky (noc)
            40: 'üåßÔ∏è', // Obƒçasn√© p≈ôeh√°≈àky (noc)
            41: '‚õàÔ∏è', // Bou≈ôky (noc)
            42: 'üå©Ô∏è', // P≈ôeh√°≈àky s blesky (noc)
            43: 'üå®Ô∏è', // Snƒõ≈æen√≠ (noc)
            44: '‚ùÑÔ∏è'  // Sm√≠≈°en√© sr√°≈æky (noc)
        };

        // Funkce pro z√≠sk√°n√≠ emoji ikony
        const getEmojiIcon = (iconNumber) => {
            return weatherIconMap[iconNumber] || '‚ùì'; // Vr√°t√≠ emoji nebo otazn√≠k, pokud nen√≠ v mapƒõ
        };

        // === VLASTN√ç MOD√ÅLN√ç DIALOG ===
        let resolveModalPromise;

        /**
         * Zobraz√≠ vlastn√≠ mod√°ln√≠ dialog s potvrzen√≠m.
         * @param {string} message Zpr√°va, kter√° se zobraz√≠ v dialogu.
         * @returns {Promise<boolean>} Promise, kter√Ω se vy≈ôe≈°√≠ na true (potvrzeno) nebo false (zru≈°eno).
         */
        function showCustomConfirm(message) {
            const modalOverlay = document.getElementById('custom-modal');
            const modalMessage = document.getElementById('modal-message');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            modalMessage.textContent = message;
            modalOverlay.classList.add('visible');

            return new Promise(resolve => {
                resolveModalPromise = resolve; // Ulo≈æ√≠me resolve funkci pro pozdƒõj≈°√≠ pou≈æit√≠

                const handleConfirm = () => {
                    modalOverlay.classList.remove('visible');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(true);
                };

                const handleCancel = () => {
                    modalOverlay.classList.remove('visible');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(false);
                };

                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }

        // === SPR√ÅVA OBL√çBEN√ùCH M√çST ===
        
        // Naƒçten√≠ obl√≠ben√Ωch m√≠st z localStorage
        function loadFavorites() {
            try {
                const favorites = localStorage.getItem('weatherFavorites');
                return favorites ? JSON.parse(favorites) : getDefaultFavorites();
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ obl√≠ben√Ωch z localStorage:', error);
                showErrorMessage('Chyba p≈ôi naƒç√≠t√°n√≠ obl√≠ben√Ωch m√≠st. Zkus to znovu.');
                return getDefaultFavorites();
            }
        }

        // V√Ωchoz√≠ obl√≠ben√° m√≠sta (m≈Ø≈æe≈° upravit podle sv√Ωch preferenc√≠, Ji≈ô√≠ku!)
        function getDefaultFavorites() {
            return [
                'Praha',
                'Pelh≈ôimov',
                'T√°bor',
                'Brno',
                'Ostrava'
            ];
        }

        // Ulo≈æen√≠ obl√≠ben√Ωch m√≠st do localStorage
        function saveFavorites(favorites) {
            try {
                localStorage.setItem('weatherFavorites', JSON.stringify(favorites));
                showSuccessMessage('Obl√≠ben√© m√≠sta ulo≈æena! üíæ');
                return true;
            } catch (error) {
                console.error('Chyba p≈ôi ukl√°d√°n√≠ obl√≠ben√Ωch do localStorage:', error);
                showErrorMessage('Chyba p≈ôi ukl√°d√°n√≠ do localStorage: ' + error.message);
                return false;
            }
        }

        // Zobrazen√≠ obl√≠ben√Ωch m√≠st
        function displayFavorites() {
            const favorites = loadFavorites();
            const favoritesListDiv = document.getElementById('favorites-list');
            
            if (favorites.length === 0) {
                favoritesListDiv.innerHTML = '<p style="color: #90a0b8;">≈Ω√°dn√° obl√≠ben√° m√≠sta. P≈ôidej nƒõjak√©! üèôÔ∏è</p>';
                return;
            }

            let html = '';
            favorites.forEach((city, index) => {
                html += `
                    <div class="favorite-item">
                        <button onclick="getWeatherForCity('${city}')" class="favorite-btn">üå§Ô∏è ${city}</button>
                        <button onclick="removeFavorite(${index})" class="remove-btn">‚ùå</button>
                    </div>
                `;
            });
            
            favoritesListDiv.innerHTML = html;
        }

        // P≈ôid√°n√≠ mƒõsta k obl√≠ben√Ωm
        function addToFavorites() {
            const cityInput = document.getElementById("city-input").value.trim();
            
            if (!cityInput) {
                showErrorMessage('Zadej n√°zev mƒõsta, kter√© chce≈° p≈ôidat k obl√≠ben√Ωm! üèôÔ∏è');
                return;
            }

            const favorites = loadFavorites();
            
            // Kontrola, jestli mƒõsto u≈æ nen√≠ v obl√≠ben√Ωch
            if (favorites.includes(cityInput)) {
                showErrorMessage(`Mƒõsto "${cityInput}" u≈æ m√°≈° v obl√≠ben√Ωch! ‚≠ê`);
                return;
            }

            favorites.push(cityInput);
            
            if (saveFavorites(favorites)) {
                displayFavorites();
                showSuccessMessage(`Mƒõsto "${cityInput}" p≈ôid√°no k obl√≠ben√Ωm! ‚≠ê`);
            }
        }

        // Odebr√°n√≠ mƒõsta z obl√≠ben√Ωch
        async function removeFavorite(index) {
            const favorites = loadFavorites();
            const cityName = favorites[index];
            
            const confirmed = await showCustomConfirm(`Opravdu chce≈° odebrat "${cityName}" z obl√≠ben√Ωch m√≠st?`);
            
            if (confirmed) {
                favorites.splice(index, 1);
                
                if (saveFavorites(favorites)) {
                    displayFavorites();
                    showSuccessMessage(`Mƒõsto "${cityName}" odebr√°no z obl√≠ben√Ωch! üóëÔ∏è`);
                }
            }
        }

        // Vymaz√°n√≠ v≈°ech obl√≠ben√Ωch m√≠st
        async function clearAllFavorites() {
            const confirmed = await showCustomConfirm('Opravdu chce≈° smazat V≈†ECHNA obl√≠ben√° m√≠sta? Tato akce je nevratn√°!');
            
            if (confirmed) {
                if (saveFavorites([])) {
                    displayFavorites();
                    showSuccessMessage('V≈°echna obl√≠ben√° m√≠sta smaz√°na! üßπ');
                }
            }
        }

        // Export obl√≠ben√Ωch m√≠st (pro z√°lohu)
        function exportFavorites() {
            const favorites = loadFavorites();
            const dataStr = JSON.stringify(favorites, null, 2);
            
            // Vytvo≈ôen√≠ souboru ke sta≈æen√≠
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'weather_favorites_backup.json';
            document.body.appendChild(link); // P≈ôidat do DOM, aby bylo mo≈æn√© kliknout
            link.click();
            document.body.removeChild(link); // Odebrat po kliknut√≠
            
            showSuccessMessage('Obl√≠ben√° m√≠sta exportov√°na! üìÅ');
        }

        // Z√≠sk√°n√≠ poƒças√≠ pro konkr√©tn√≠ mƒõsto z obl√≠ben√Ωch
        function getWeatherForCity(cityName) {
            document.getElementById("city-input").value = cityName;
            getWeather();
        }

        // === POMOCN√â FUNKCE PRO ZPR√ÅVY ===
        
        function showErrorMessage(message) {
            const errorDiv = document.getElementById("error-message");
            errorDiv.textContent = message;
            errorDiv.style.display = "block";
            
            // Automatick√© skryt√≠ po 5 sekund√°ch
            setTimeout(() => {
                errorDiv.style.display = "none";
            }, 5000);
        }

        function showSuccessMessage(message) {
            const successDiv = document.getElementById("success-message");
            successDiv.textContent = message;
            successDiv.style.display = "block";
            
            // Automatick√© skryt√≠ po 3 sekund√°ch
            setTimeout(() => {
                successDiv.style.display = "none";
            }, 3000);
        }

        function hideAllMessages() {
            document.getElementById("error-message").style.display = "none";
            document.getElementById("success-message").style.display = "none";
        }

        // === DEBUG FUNKCE ===
        
        function showDebugInfo() {
            const debugDiv = document.getElementById("debug-info");
            const debugContent = document.getElementById("debug-content");
            
            try {
                const favorites = loadFavorites();
                const storageSize = JSON.stringify(favorites).length;
                
                let debugHtml = `
                    <p><strong>Poƒçet obl√≠ben√Ωch m√≠st:</strong> ${favorites.length}</p>
                    <p><strong>Velikost dat:</strong> ${storageSize} byt≈Ø</p>
                    <p><strong>Obsah 'weatherFavorites' v localStorage:</strong></p>
                    <pre style="background-color: #0f1825; padding: 10px; border-radius: 5px; overflow-x: auto;">
${JSON.stringify(favorites, null, 2)}
                    </pre>
                    <p><strong>Celkov√Ω obsah localStorage:</strong></p>
                    <pre style="background-color: #0f1825; padding: 10px; border-radius: 5px; overflow-x: auto; max-height: 200px; overflow-y: auto;">
`;
                
                // Zobrazen√≠ v≈°ech kl√≠ƒç≈Ø v localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    debugHtml += `${key}: ${value}\n`;
                }
                
                debugHtml += `</pre>`;
                
                debugContent.innerHTML = debugHtml;
                debugDiv.style.display = debugDiv.style.display === "none" ? "block" : "none";
                
            } catch (error) {
                debugContent.innerHTML = `<p style="color: #ff6b6b;">Chyba p≈ôi naƒç√≠t√°n√≠ debug informac√≠: ${error.message}</p>`;
                debugDiv.style.display = "block";
            }
        }

        // === HLAVN√ç FUNKCE PRO POƒåAS√ç ===
        
        async function getWeather() {
            const cityInput = document.getElementById("city-input").value.trim();
            const weatherInfoDiv = document.getElementById("weather-info");
            const loadingMessageDiv = document.getElementById("loading-message");

            // Skryt√≠ v≈°ech zpr√°v a p≈ôedchoz√≠ch v√Ωsledk≈Ø
            hideAllMessages();
            weatherInfoDiv.innerHTML = "";
            weatherInfoDiv.style.display = "none";
            loadingMessageDiv.style.display = "block";
            console.log(`Pokou≈°√≠m se z√≠skat poƒças√≠ pro: ${cityInput}`);

            if (!cityInput) {
                showErrorMessage("Pros√≠m, zadej n√°zev mƒõsta, Ji≈ô√≠ku! Tohle nen√≠ futuristick√Ω kv√≠z, tady mus√≠me m√≠t vstup!");
                loadingMessageDiv.style.display = "none";
                return;
            }

            if (ACCUWEATHER_API_KEY === "TVUJ_API_KLIC_ZDE" || ACCUWEATHER_API_KEY === "") {
                showErrorMessage("Je≈æ√≠≈°ku, Ji≈ô√≠ku! Zapomnƒõl jsi vlo≈æit sv≈Øj AccuWeather API kl√≠ƒç do k√≥du!");
                loadingMessageDiv.style.display = "none";
                return;
            }

            try {
                // Aktualizace glob√°ln√≠ promƒõnn√©
                currentCity = cityInput;

                // Krok 1: Z√≠sk√°n√≠ Location Key pro zadan√© mƒõsto
                console.log(`Vol√°m Location Search API: ${LOCATION_SEARCH_URL}?apikey=...&q=${cityInput}&language=cs-cz`);
                const locationResponse = await fetch(`${LOCATION_SEARCH_URL}?apikey=${ACCUWEATHER_API_KEY}&q=${cityInput}&language=cs-cz`);
                
                if (!locationResponse.ok) {
                    const errorText = await locationResponse.text(); // Zkus√≠me z√≠skat text chyby
                    console.error("Chyba p≈ôi Location Search API:", locationResponse.status, errorText);
                    throw new Error(`Location API vr√°tilo chybu ${locationResponse.status}: ${errorText || locationResponse.statusText}`);
                }
                const locationData = await locationResponse.json();
                console.log("Location Data:", locationData);

                if (locationData.length === 0) {
                    throw new Error(`Mƒõsto "${cityInput}" nenalezeno nebo chyba API. Zkus to p≈ôesnƒõji, kapit√°ne!`);
                }

                const locationKey = locationData[0].Key;
                const cityName = locationData[0].LocalizedName;
                console.log(`Nalezeno mƒõsto: ${cityName}, Location Key: ${locationKey}`);

                // Krok 2: Z√≠sk√°n√≠ aktu√°ln√≠ch podm√≠nek
                console.log(`Vol√°m Current Conditions API: ${CURRENT_CONDITIONS_URL}${locationKey}?apikey=...&language=cs-cz&details=true`);
                const currentConditionsResponse = await fetch(`${CURRENT_CONDITIONS_URL}${locationKey}?apikey=${ACCUWEATHER_API_KEY}&language=cs-cz&details=true`);
                
                if (!currentConditionsResponse.ok) {
                    const errorText = await currentConditionsResponse.text();
                    console.error("Chyba p≈ôi Current Conditions API:", currentConditionsResponse.status, errorText);
                    throw new Error(`Current Conditions API vr√°tilo chybu ${currentConditionsResponse.status}: ${errorText || currentConditionsResponse.statusText}`);
                }
                const currentConditionsData = await currentConditionsResponse.json();
                console.log("Current Conditions Data:", currentConditionsData);

                if (currentConditionsData.length === 0) {
                    throw new Error("Nepoda≈ôilo se z√≠skat aktu√°ln√≠ podm√≠nky.");
                }

                const current = currentConditionsData[0];

                // Krok 3: Z√≠sk√°n√≠ 5denn√≠ p≈ôedpovƒõdi
                console.log(`Vol√°m 5-Day Forecast API: ${FORECAST_5_DAY_URL}${locationKey}?apikey=...&language=cs-cz&details=true&metric=true`);
                const forecastResponse = await fetch(`${FORECAST_5_DAY_URL}${locationKey}?apikey=${ACCUWEATHER_API_KEY}&language=cs-cz&details=true&metric=true`);
                
                if (!forecastResponse.ok) {
                    const errorText = await forecastResponse.text();
                    console.error("Chyba p≈ôi 5-Day Forecast API:", forecastResponse.status, errorText);
                    throw new Error(`5-Day Forecast API vr√°tilo chybu ${forecastResponse.status}: ${errorText || forecastResponse.statusText}`);
                }
                const forecastData = await forecastResponse.json();
                console.log("Forecast Data:", forecastData);

                if (!forecastData.DailyForecasts || forecastData.DailyForecasts.length === 0) {
                    throw new Error("Nepoda≈ôilo se z√≠skat p≈ôedpovƒõƒè na 5 dn√≠.");
                }

                // Zobrazen√≠ dat na str√°nce
                let htmlOutput = `<h2>Poƒças√≠ pro ${cityName}</h2>`;

                // --- Aktu√°ln√≠ podm√≠nky v tabulce ---
                htmlOutput += `<h3>Aktu√°ln√≠ stav:</h3>`;
                htmlOutput += `<table class="current-conditions-table">`;
                htmlOutput += `<thead>
                                        <tr>
                                            <th>Informace</th>
                                            <th>Hodnota</th>
                                        </tr>
                                    </thead>`;
                htmlOutput += `<tbody>`;

                // Data z aktu√°ln√≠ch podm√≠nek
                htmlOutput += `<tr><td>Teplota</td><td>${current.Temperature.Metric.Value}¬∞C</td></tr>`;
                htmlOutput += `<tr><td>Popis</td><td>${current.WeatherText}</td></tr>`;
                htmlOutput += `<tr><td>Pocitov√° teplota</td><td>${current.RealFeelTemperature.Metric.Value}¬∞C</td></tr>`;
                htmlOutput += `<tr><td>Vlhkost</td><td>${current.RelativeHumidity}%</td></tr>`;
                htmlOutput += `<tr><td>V√≠tr</td><td>${current.Wind.Speed.Metric.Value} km/h ${current.Wind.Direction.Localized}</td></tr>`;
                htmlOutput += `<tr><td>UV Index</td><td>${current.UVIndex} (${current.UVIndexText})</td></tr>`;
                htmlOutput += `<tr><td>Tlak</td><td>${current.Pressure.Metric.Value} hPa (${current.PressureTendency.LocalizedText})</td></tr>`;
                htmlOutput += `<tr><td>Rosn√Ω bod</td><td>${current.DewPoint.Metric.Value}¬∞C</td></tr>`;
                htmlOutput += `<tr><td>Viditelnost</td><td>${current.Visibility.Metric.Value} km</td></tr>`;
                htmlOutput += `<tr><td>Oblaƒçnost</td><td>${current.CloudCover}%</td></tr>`;
                htmlOutput += `<tr><td>Sr√°≈æky (minulou hodinu)</td><td>${current.HasPrecipitation ? (current.PrecipitationType || 'Nezn√°m√©') + ' ' + current.PrecipitationSummary.PastHour.Metric.Value + ' mm' : '≈Ω√°dn√©'}</td></tr>`;
                htmlOutput += `<tr><td>Slunce</td><td>${current.IsDayTime ? 'Den ‚òÄÔ∏è' : 'Noc üåô'}</td></tr>`;
                htmlOutput += `<tr><td>ƒåas aktualizace</td><td>${new Date(current.LocalObservationDateTime).toLocaleTimeString('cs-CZ')}</td></tr>`;
                
                htmlOutput += `</tbody></table>`;

                // --- P≈ôedpovƒõƒè na 5 dn√≠ v tabulce ---
                htmlOutput += `<h3>P≈ôedpovƒõƒè na 5 dn√≠:</h3>`;
                htmlOutput += `<table class="forecast-table">`;
                htmlOutput += `<thead>
                                        <tr>
                                            <th>Datum</th>
                                            <th>Min. Teplota</th>
                                            <th>Max. Teplota</th>
                                            <th>Den</th>
                                            <th>Noc</th>
                                        </tr>
                                    </thead>`;
                htmlOutput += `<tbody>`;

                forecastData.DailyForecasts.forEach(day => {
                    const date = new Date(day.Date).toLocaleDateString('cs-CZ', { weekday: 'short', day: 'numeric', month: 'numeric' });
                    
                    const minTemp = day.Temperature.Minimum.Value;
                    const maxTemp = day.Temperature.Maximum.Value;
                    const dayDescription = day.Day.IconPhrase;
                    const dayPrecipitationProbability = day.Day.PrecipitationProbability;
                    const nightDescription = day.Night.IconPhrase;
                    const nightPrecipitationProbability = day.Night.PrecipitationProbability;

                    htmlOutput += `
                        <tr>
                            <td>${date}</td>
                            <td>${minTemp}¬∞C</td>
                            <td>${maxTemp}¬∞C</td>
                            <td>
                                <span class="weather-icon">${getEmojiIcon(day.Day.Icon)}</span>
                                ${dayDescription}<br>
                                Sr√°≈æky: ${dayPrecipitationProbability}%
                            </td>
                            <td>
                                <span class="weather-icon">${getEmojiIcon(day.Night.Icon)}</span>
                                ${nightDescription}<br>
                                Sr√°≈æky: ${nightPrecipitationProbability}%
                            </td>
                        </tr>
                    `;
                });

                htmlOutput += `</tbody></table>`;

                weatherInfoDiv.innerHTML = htmlOutput;
                weatherInfoDiv.style.display = "block";
                showSuccessMessage(`Poƒças√≠ pro ${cityName} √∫spƒõ≈°nƒõ naƒçteno! üöÄ`);

            } catch (error) {
                console.error("Chyba p≈ôi z√≠sk√°v√°n√≠ poƒças√≠:", error);
                showErrorMessage(`Chyba p≈ôi komunikaci s API: ${error.message}. Zkus to znovu, nebo zkontroluj konzoli prohl√≠≈æeƒçe (F12 -> Console/Network) pro detailnƒõj≈°√≠ chyby, jako spr√°vn√Ω program√°tor! Mo≈æn√° je to CORS nebo s√≠≈•ov√Ω probl√©m.`);
            } finally {
                loadingMessageDiv.style.display = "none";
            }
        }

        // === INICIALIZACE P≈òI NAƒåTEN√ç STR√ÅNKY ===
        
        document.addEventListener('DOMContentLoaded', function() {
            // Zobrazen√≠ obl√≠ben√Ωch m√≠st p≈ôi naƒçten√≠ str√°nky
            displayFavorites();
            
            // P≈ôid√°n√≠ Enter kl√°vesy pro vyhled√°v√°n√≠
            document.getElementById('city-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    getWeather();
                }
            });
            
            console.log('Poƒças√≠ aplikace naƒçtena! Obl√≠ben√° m√≠sta:', loadFavorites());
        });
    </script>
</body>
</html>
